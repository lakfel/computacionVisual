<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Proyecto 10</title>
<!--
Neaty HTML Template
http://www.templatemo.com/tm-501-neaty
-->
    <!-- load stylesheets -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400">  <!-- Google web font "Open Sans" -->
	<script type="text/javascript" src="proyectoFinal/sylvester.src.js"></script>
	<script type="text/javascript" src="proyectoFinal/glUtils.js"></script>
	<script type="text/javascript" src="proyectoFinal/webgl-path-tracing.js"></script>
    <link rel="stylesheet" href="css/bootstrap.min.css">                                      <!-- Bootstrap style -->
    <link rel="stylesheet" href="css/magnific-popup.css">                                <!-- Magnific pop up style, http://dimsemenov.com/plugins/magnific-popup/ -->
    <link rel="stylesheet" href="css/templatemo-style.css">                                   <!-- Templatemo style -->

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
          <![endif]-->
</head>
    <body >        
        <div class="container">
            <div class="row">
                <div class="tm-left-right-container">
                    <!-- Left column: logo and menu -->
                    <div class="tm-blue-bg tm-left-column">                        
                        <div class="tm-logo-div text-xs-center">
							</br>
                             <a href = "index.html"><img  id = "FotoPrincipal" src="img/foto3.jpg" alt="Johann Felipe González Ávila"  data-rotate="90"></a>
							</br>
							</br>
                            <h1 class="tm-site-name">Johann Felipe González Ávila</h1>
							</br>
							<h4>Computación Visual Interactiva.</h4>
                        </div>
                        <nav class="tm-main-nav">
                            <ul class="tm-main-nav-ul">
                                <li class="tm-nav-item">
                                    <a href="index.html" class="tm-nav-item-link">¿Qué es esto?</a>
                                </li>
                                <li class="tm-nav-item">
                                    <a href="index.html" class="tm-nav-item-link">Proyectos</a>
                                </li>
                                
                            </ul>
                        </nav>                                         
                    </div> <!-- Left column: logo and menu -->
                    
                    <!-- Right column: content -->
                    <div class="tm-right-column">
						<!--audio src="proyecto7/joga.mp3" controls autoplay loop>	
							<p>Tu navegador no implementa el elemento audio.</p>
						</audio-->
                        <!--figure>
                            <img src="img/neaty-01.jpg" alt="Header image" class="img-fluid">    
                        </figure-->

                        <div class="tm-content-div">
                            <!-- Welcome section -->
                            <section id="Presentacion" class="tm-section">
                                <header>
                                    <h1 class="tm-blue-text tm-welcome-title tm-margin-b-45">Proyecto Final</h1>
                                </header>
								
								<div id = "Presentacion">
									<h2> Presentación </h2>
									<p>Con los conocimientos adquiridos en el curso se debe proponer algun tipo de aplicación desarrollada en WebGl. Por mi parte, encontré muy interesante la vanguardia en visualización 3D referente a Ray Tracing. En este sentido pretendo realizar un símil más sencillo del software <a href = "https://www.dial.de/en/dialux/">dialux</a> que está desarrollado en OpenGl pero para WebGl</p>
									
									<h2> <a href = "https://www.dial.de/en/dialux/">DIALUX</a>  </h2>
									<p>Dialux es un software que permite realizar escenas donde se incluyan luces a diferente intensidades y colores. El software permite calcular y visualizar simulaciones de los resultados arquitecturales de posicionar luces en una escena.</p>
									<img src = "proyectoFinal/imgs/presentacion2.png">
									</br>
									</br>
								</div>
									
								<div id="main">
								
									<h2> Tecnologías </h2>
								
									<p>Para este proyecto he partido del ejemplo presentado en el <a href = "proyecto10.html">proyecto 10</a> que es una adecuación del código original de Evan que se puede encontrar en <a href="http://madebyevan.com/webgl-path-tracing/">este link</a> Y cuyo código fuente lo encuentran en github. Lo que se está realizando es un estudio de la aplicación de la luz. En este caso pbservamos que la luz no cuenta </p>

									<p>A continuación encontramos un poco de contexto para entender la complejidad del proyecto y todo lo realizado</p>

									<h3> Pipeline Original</h3>

									<p>El proyecto, al igual que el curso, se desarrolla completamente en WebGL. Esta tecnología utiliza una mezcla de procesamiento en CPU y GPU para dar como resultado escenas interactivas en 2D y 3D. El marco habitual de el despliegue de escenas en WebGl de manera <strong>MUY SIMPLIFICADA</strong> sigue la siguiente lógica.</p>
									
									<p>Se describen los objetos y todas sus propiedades en un modelo tridimensional. En espécifico se realizan dibujos de superficies por medio de triangulos, puntos o líneas (Se puede incluso en polígonos), colores y texturas. Esta información se le pasa a un primer programa llamado <strong>VERTEX SHADER</strong> que calcula por medio de proyecciones, la posición de vertices en el plano de la pantalla junto con los polígonos creados. A este primer programa debemos darle la posición de todos los vertices que forman las figuras que estamos creando</p>	

									<p>Un segundo programa <strong>FRAGMENT SHADER</strong> cálcula para cada pixel los colores.</p>	
									
									<img src = "proyectoFinal/imgs/pipelineTradicional.jpg">
									<p>Imágen tomada de https://www.safaribooksonline.com/library/view/webgl-beginners-guide/9781849691727/ch02s02.html</p>

									<h3>Ray tarcing</h3>
									<p> Este nuevo modelo cambia completamente la filosofía. Dibujar los elementos dependen de las fuentes de luz y como estas afectan los objetos. No encontré mejor manera de describirlo que robandome un vídeo.</p>
									<iframe width="420" height="315"
									src="https://www.youtube.com/embed/frLwRLS_ZR0?start=60">
									</iframe>
									<p> Consiste en calcular, que de la fuente de luz se envían multiples rayos que van rebotando un determinado de veces en los objetos e iluminandolos. En ese transcurso calculamos los colores gracias a esos rebotes. Es claro que la ciencia detrás es algo más copleja pero la idea es esa. Debido a las limitaciones que nosotros tenemos impuestas por el Pipeline de WebGl, el proyecto base utiliza una ideología similar que describo en la siguiente ilustración</p>
									<img src = "proyectoFinal/imgs/pipeLinePropio.png">
									<p> Los rayos los enviamos nosotros desde cada pixel, calculamos el aporte de la fuente de luz y realizamos un determinado número de rebotes. De manera general es lo que se hace. Continuemos con el uso que le damos a esta técnica.</p>
	
									<h2> Contexto </h2>

									<p>Por interés de una arquitecta que trabajo en el diseño profesional de luces, se requiere realizar un software para el cálculo realista de luces en ambientes. Como punto de referencia se toma el software DiaLux antes descrito.</p> 

									<p>En principio se quiere agregar más y más características físicas de luminotecnia en la iteracción de objetos y luces en el proyecto. De momento estamos aplicando 3 elementos</p>

									<h2> Iluminancia </h2>

									<p>Es una magnitud característica del objeto iluminado, que indica la cantidad de luz que incide sobre su superficie, al ser iluminado por la fuente.</p>
									<p>E = I/d2<br>
									<br>
									 E = nivel de iluminación en lux<br>
									 I = Intensidad luminosa en candelas<br>
									 d = distancia en metros.</p>

									<h2> Luminancia </h2>

									<p>La luminancia es la relación entre la intensidad luminosa y la superficie aparente. La superficie aparente es la proyección dela superficie real sobre un plano perpendicular a la dirección de la mirada. El valor de la superficie aparente se calcula como producto de la superficie real por el coseno del ángulo que forma la dirección de la mirada con la perpendicular a dicha superficie (cos Θ).</p>
									<p>  L = I/ (S x cos Θ )
									<br>

									  I = Intensidad luminosa en candelas.<br>
									  S = Superficie en cm2  o m2  <br>
									  L = Luminancia en cd/cm2 o cd/m2  <br>
									
									<img src = "proyectoFinal/imgs/luminancia.jpg">

									<h2> Archvos IES </h2>
									<p> Los archivos de datos que se crean mediante el IES (Illuminating Engineering Society) formato estandarizado fotométrica son llamados archivos IES; por lo que se consideran archivos IES fotométricos IES archivos de datos. Estos archivos guardan las cantidades de luz y mediciones, por lo que son útiles para la simulación de sistemas de iluminación antes de ser instalados en los edificios. Aparte de eso, archivos IES también son útiles para el examen de la iluminación fuente de luz para los sitios al aire libre como carreteras, etc. Desde que se ocupan principalmente de los datos de iluminación y fotometría, muchos programas de 3D utilizan este formato de archivo, así como la mayoría de los fabricantes de iluminación publican este archivo formato. archivos IES lo general se abren y ver con el uso de Autodesk Revit Architecture 2013, una aplicación más usada por los diseñadores y arquitectos. Permite a los usuarios crear diseños arquitectónicos de la más alta calidad y precisión. Esta aplicación se ejecuta en un sistema operativo Windows.</p>

									<p> En cocreto el archivo moldea el comportamiento de los luces dada una dirección y ángulos de desplazamiento. Un archivo IES abierto con un SW especializado me da esta información de la siguiente manera</p>

									
									<img src = "proyectoFinal/imgs/ejemplosIES.png">

									<p> Es claro como nos dice como se debe comportar la luz a diferentes ángulos que golpean al centro de la fuente.</p>


									<h2> Resultados </h2>

									<p>Se han logrado incorporar estos elementos en WebGl permitiendo cargar información de archivos IES en un ambiente donde en principio solo s epueden crear, esferas, cubos y cilindros. Las luces cuentan con parámetros de localización, color y orientación manipulables en ejecución. También cuenta con información IES aunque esta de momento solo se tienen 3 tipos de archivos en los cuales se pueden seleccionar</p>


									<p>En función de poder realizar una validación del éxito o fracaso de las visualizaciones hemos partido de 2 programas exernos para poder, de manera cualitativa, emitir un juicio. Estos programas son Dialux que permite generar una escena e incluir luces, y IES Viewer que permite ver el patrón de radiación de una luz determinada </br>. Además hemos consultado a una experta en el uso de este tipo de software para conocer su apreciación</p>


									<p>A continuación se muestra como se carga una sola Luz en cada software pegado a la pared para ver su patrón y el resultado de IES Viewer</p>
				

									<table>
										<tr>
											<td style = "width:30%">
												<img src = "proyectoFinal/imgs/ej1Dialux.png" width = "100%">
											</td>
											<td style = "width:30%">
												<img src = "proyectoFinal/imgs/ej1Ray.png" width = "100%">
											</td>
											<td style = "width:40%">
												<img src = "proyectoFinal/imgs/ej1Viewer.png" width = "100%">
											</td>
										</tr>
										<tr>
											<td style = "width:30%">
												<img src = "proyectoFinal/imgs/ej2Dialux.png" width = "100%">
											</td>
											<td style = "width:30%">
												<img src = "proyectoFinal/imgs/ej2Ray.png" width = "100%">
											</td>
											<td style = "width:40%">
												<img src = "proyectoFinal/imgs/ej2Viewer.png" width = "100%">
											</td>
										</tr>
										<tr>
											<td style = "width:30%">
												<img src = "proyectoFinal/imgs/ej3Dialux.png" width = "100%">
											</td>
											<td style = "width:30%">
												<img src = "proyectoFinal/imgs/ej3Ray.png" width = "100%">
											</td>
											<td style = "width:40%">
												<img src = "proyectoFinal/imgs/ej3Viewer.png" width = "100%">
											</td>
										</tr>
									</table>
									<p>Otros ejemplos mostrando entre Dialux y nuestro ejemplo en Ray tracing</p>
									<table>
										<tr>
											<td style = "width:50%">
												<img src = "proyectoFinal/imgs/escena1Dialux.png" width = "100%">
											</td>
											<td style = "width:50%">
												<img src = "proyectoFinal/imgs/escena1Ray.png" width = "100%">
											</td>
										</tr>
										<tr>
											<td style = "width:50%">
												<img src = "proyectoFinal/imgs/escena2Dialux.png" width = "100%">
											</td>
											<td style = "width:50%">
												<img src = "proyectoFinal/imgs/escena2Ray.png" width = "100%">
											</td>
										</tr>
									</table>

									<h2> Opinion de la experta </h2>
									<h2> Conclusiones </h2>

									<p>El resultado es cercano sin embargo es necesario ajustar varias cosas.</p>
									<ul>
										<li>Manejabilidad de las luces.</li>
										<li>Carga de archivos IES.</li>
										<li>Carga de modelos para otros espacios.</li>
										<li>Manejo de la sombra.</li>
									</ul>
									<table>
										<tr>
											<td>
												<canvas id="canvas" width="512" height="512"></canvas>
												<div id="error"><noscript>Please enable JavaScript.</noscript></div>
											</td>
											<td>
												<div>
													<table>
														<tr>
															<td>
																<>Lights</p>
															</td>
														</tr>
														<tr>
															<td>
																<input type="file" id="file-input" onchange = "readFile()"/>
																	
															
															</td>
														
														<tr>
														<tr>
															<td>
																<button onclick="javascript:ui.addLight()">Add Light</button>
															</td>
															<td>
																<button onclick="javascript:ui.deleteLight()">Delete Light</button>
															</td>
														
														<tr>
															
															<td>
																<select id = "lightsSelect" onchange = "javascript:selectChange()"></select>
															</td>
															<td>
																<button onclick="javascript:ui.selectLight()">Select Light</button>
															</td>
														</tr>
														<tr>
															
															<td>
																<select id = "iesSelect" onchange = "javascript:selectChange()">
																	<option value = "S1">IES 1</option>
																	<option value = "S2">IES 2</option>
																	<option value = "S3">IES 3</option>
																</select>
															</td>
														</tr>
														<tr>
															<td style = "width : 10%">
																<p>Red</p>
															</td>
															<td style = "width : 80%">
																<input type = "range" max = "255" min = "0" id = "redRange" oninput = "onChangeRanges()">
															</td>
															<td style = "width : 10%">
																<p id = "forRedRange"></p>
															</td>
														</tr>
														<tr>
															<td style = "width : 10%">
																<p>Greeb</p>
															</td>
															<td style = "width : 80%">
																<input type = "range" max = "255" min = "0" id = "greenRange" oninput = "onChangeRanges()">
															</td>
															<td style = "width : 10%">
																<p id = "forGreenRange"></p>
															</td>
														</tr>
														<tr>
															<td style = "width : 10%">
															<p>Blue</p>
															</td>
															<td style = "width : 80%">
																<input type = "range" max = "255" min = "0" id = "blueRange" oninput = "onChangeRanges()">
															</td>
															<td style = "width : 10%">
																<p id = "forBlueRange"></p>
															</td>
														</tr>
														
														<tr>
															<td>
																<p>Size</p>
															</td>
															<td>
																<input type = "range" min = "0" max = "4" step = "0.05" id = "sizeRange" oninput = "onChangeRanges()">
															</td>
															<td>
																<p id = "forSizeRange"></p>
															</td>
														</tr>

														<tr>
															<td>
																<p>Rotation X</p>
															</td>
															<td>
																<input type = "range" min = "-180" max = "180" step = "0.05" id = "rotationXRange" oninput = "onChangeRanges()">
															</td>
															<td>
																<p id = "forRotationXRange"></p>
															</td>
														</tr>
<tr>
															<td>
																<p>Rotation Y</p>
															</td>
															<td>
																<input type = "range" min = "-180" max = "180" step = "0.05" id = "rotationYRange" oninput = "onChangeRanges()">
															</td>
															<td>
																<p id = "forRotationYRange"></p>
															</td>
														</tr>
<tr>
															<td>
																<p>Rotation Z</p>
															</td>
															<td>
																<input type = "range" min = "-180" max = "180" step = "0.05" id = "rotationZRange" oninput = "onChangeRanges()">
															</td>
															<td>
																<p id = "forRotationZRange"></p>
															</td>
														</tr>
													</table>
												</div>
											</td>
										</tr>
									</table>
									<p>
									  <button onclick="javascript:ui.addSphere()">Add Sphere</button>
									  <button onclick="javascript:ui.addCube()">Add Cube</button>
									  <button onclick="javascript:ui.addCylinder()">Add Cylinder</button>
									</p>
									
									

									<p>
									  <b>Material:</b>
									  <select id="material">
										<option value="0" selected>Diffuse</option>
										<option value="1">Mirror</option>
										<option value="2">Glossy</option>
									  </select>
									  <span id="glossiness-factor">
										<br>with glossiness factor: 0 &lt; <input id="glossiness" value="0.6"> &lt; 1
									  </span>
									  <br>

									  <b>Environment:</b>
									  <select id="environment">
										<option value="0" selected>Cornell Box - Yellow and Blue</option>
										<option value="1">Cornell Box - Red and Green</option>
									  </select>
									</p>

									<p>
									  <b>Load preset scene:</b>
									  <br><button onclick="javascript:ui.setObjects(makeSphereColumn(),lights)">Sphere Column</button>
									  <br><button onclick="javascript:ui.setObjects(makeSpherePyramid(),lights)">Sphere Pyramid</button>
									  <br><button onclick="javascript:ui.setObjects(makeSphereAndCube(),lights)">Sphere and Cube</button>
									  <br><button onclick="javascript:ui.setObjects(makeCubeAndSpheres(),lights)">Cube and Spheres</button>
									  <br><button onclick="javascript:ui.setObjects(makeSphereCylinderColumn(),lights)">Hello world</button>
									  <br><button onclick="javascript:ui.setObjects(makeTableAndChair(),lights)">Table and Chair</button>
									  <br><button onclick="javascript:ui.setObjects(makeStacks(),lights)">Stacks</button>
									</p>
									
									<h3> Luminotecnia</h3>
								
									<p>Empiezo a trabajar en una librería que permita introducir principios físicos de luminotecnia para darle realismo a la aplicación. En específico se quiere tener en cuenta los siguientes aspectos:</p>
									<ul>
										<li><strong>Flujo luminoso: </strong>Flujo luminoso es la cantidad total de iluminación emitida por una fuente de luz en una unidad de tiempo, la unidad de medida es el lumen (lm). Se utiliza para indicar la cantidad de luz manifestada en una superficie o para señalar la reproducción luminosa de una fuente. Cuando la fuente de luz es una lámpara el flujo luminoso no se reparte de manera uniforme. El flujo luminoso Փ es un índice representativo de la potencia luminosa de una fuente de luz. Փ = lumen (lm)..</li>
										<li><strong>Eficacia luminosa: </strong>La eficacia luminosa describe el rendimiento de una lámpara. Se expresa mediante la relación del flujo luminoso entregado, en lumen y la potencia consumida, en vatios. El valor teórico máximo alcanzable con una conversión total de la energía a 555 nm sería 683 lm/W. Las eficacias luminosas realmente alcanzables varían en función del manantial de luz, pero quedan siempre por debajo de este valor ideal.</li>
										<li><strong>Intensidad luminosa.</strong>La intensidad luminosa de una fuente de luz en una dirección dada, es la relación que existe entre el flujo luminoso contenido en un ángulo sólido cualquiera, cuyo eje coincida con la dirección considerada y el valor de dicho ángulo sólido expresado en estereoradianes. Su unidad es la candela (cd).</li>
										<li><strong>Iluminancia:  </strong>La iluminancia es un índice representativo de la densidad del flujo luminoso sobre una superficie. Se define como la relación entre el flujo luminoso que incide sobre una superficie y el tamaño de esta superficie. A su vez la iluminancia no se encuentra vinculada a una superficie real, puede ser determinada en cualquier lugar del espacio. La iluminancia se puede deducir de la intensidad luminosa. Al mismo tiempo disminuye la iluminancia con el cuadrado de la distancia de la fuente de luz (ley de la inversa del cuadrado de la distancia). Su unidad es el lux..</li>
										<li><strong>Luminancia:</strong>Mientras que la iluminancia nos describe la potencia luminosa que incide en una superficie, vemos que la luminancia nos describe la luz que procede de esa misma superficie. A su vez dicha luz puede ser procedente de la superficie misma (p.ej. en el caso de la luminancia de lámparas y luminarias). También vemos que la luminancia se encuentra definida como la relación entre la intensidad luminosa y la superficie proyectada sobre el plano perpendicularmente a la dirección de irradiación. Pero es posible que la luz sea reflejada o transmitida por la superficie. En el caso de materiales que reflejan en forma dispersa (mateados) y que transmiten en forma dispersa (turbios), es posible averiguar la luminancia a base de la iluminancia y el grado de reflexión (reflectancia) o transmisión (transmitancia). La luminosidad está en relación con la luminancia; no obstante, la impresión verdadera de luminosidad está bajo la influencia del estado de adaptación del ojo, del contraste circundante y del contenido de información de la superficie a la vista. La luminancia L de una superficie luminiscente resulta de la relación entre la intensidad luminosa I y su superficie proyectada Ap.</li>
									</ul>
									
									
									
								  </div>
								
                            </section>   
                        </div>  
                        
                    </div> <!-- Right column: content -->
                </div>
            </div> <!-- row -->
        </div> <!-- container -->
                
        <!-- load JS files -->
        <script src="js/jquery-1.11.3.min.js"></script>             <!-- jQuery (https://jquery.com/download/) -->
        <script src="js/jquery.magnific-popup.min.js"></script>     <!-- Magnific pop-up (http://dimsemenov.com/plugins/magnific-popup/) -->
        <script src="js/jquery.singlePageNav.min.js"></script>      <!-- Single Page Nav (https://github.com/ChrisWojcik/single-page-nav) -->
        
		<script>     
       
            $(document).ready(function(){
				
				

				document.getElementById('file-input').addEventListener('change', readFile, false);

                // Single page nav
                $('.tm-main-nav').singlePageNav({
                    'currentClass' : "active",
                    offset : 20
                });

                // Magnific pop up
                $('.tm-gallery-1').magnificPopup({
                  delegate: 'a', // child items selector, by clicking on it popup will open
                  type: 'image',
                  gallery: {enabled:true}
                  // other options
                }); 

                $('.tm-gallery-2').magnificPopup({
                  delegate: 'a', // child items selector, by clicking on it popup will open
                  type: 'image',
                  gallery: {enabled:true}
                  // other options
                }); 

                $('.tm-gallery-3').magnificPopup({
                  delegate: 'a', // child items selector, by clicking on it popup will open
                  type: 'image',
                  gallery: {enabled:true}
                  // other options
                }); 

                $('.tm-current-year').text(new Date().getFullYear());                
            });
        </script>             
</body>
</html>