<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Ejemplo</title>
<!--
Neaty HTML Template
http://www.templatemo.com/tm-501-neaty
-->
    <!-- load stylesheets -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400">  <!-- Google web font "Open Sans" -->
	<script src = "https://rawgit.com/Falkulator/3D-multi-shmup-prototype/master/public/javascripts/glMatrix-0.9.5.min.js"></script>
	<script src = "https://rawgit.com/kmindi/webgl-utils.js/master/webgl-utils.js"></script>
	<script src = "js/proy2.js"></script>
    <link rel="stylesheet" href="css/bootstrap.min.css">                                      <!-- Bootstrap style -->
    <link rel="stylesheet" href="css/magnific-popup.css">                                <!-- Magnific pop up style, http://dimsemenov.com/plugins/magnific-popup/ -->
    <link rel="stylesheet" href="css/templatemo-style.css">                                   <!-- Templatemo style -->

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
          <![endif]-->
		  
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
</head>
    <body >        
        <div class="container">
            <div class="row">
                <div class="tm-left-right-container">
                    <!-- Left column: logo and menu -->
                    <div class="tm-blue-bg tm-left-column">                        
                        <div class="tm-logo-div text-xs-center">
							</br>
                             <a href = "index.html"><img  id = "FotoPrincipal" src="img/foto3.jpg" alt="Johann Felipe González Ávila"  data-rotate="90"></a>
							</br>
							</br>
                            <h1 class="tm-site-name">Johann Felipe González Ávila</h1>
							</br>
							<h4>Computación Visual Interactiva.</h4>
                        </div>
                        <nav class="tm-main-nav">
                            <ul class="tm-main-nav-ul">
                                <li class="tm-nav-item">
                                    <a href="index.html" class="tm-nav-item-link">¿Qué es esto?</a>
                                </li>
                                <li class="tm-nav-item">
                                    <a href="index.html" class="tm-nav-item-link">Proyectos</a>
                                </li>
                                
                            </ul>
                        </nav>                                         
                    </div> <!-- Left column: logo and menu -->
                    
                    <!-- Right column: content -->
                    <div class="tm-right-column">
                        <!--figure>
                            <img src="img/neaty-01.jpg" alt="Header image" class="img-fluid">    
                        </figure-->

                        <div class="tm-content-div">
                            <!-- Welcome section -->
                            <section id="Presentacion" class="tm-section">
                                <header>
                                    <h2 class="tm-blue-text tm-welcome-title tm-margin-b-45">Modelo</h2>
                                </header>
                                <p>En este ocasión era mi intención seleccionar un ejemplo que fuera de mi interés para mostrarles. En ese sentido me he encontrado un ejemplo de la cuenta github <a href = "https://github.com/evanw/webgl-water">evanw</a> que me parece simplemente impresionante. Acá podemos verlo.</p>
								
								
								
								<iframe src="http://madebyevan.com/webgl-water/" title="iframe example 1" width="1000" height="800">
  <p>Your browser does not support iframes.</p>
</iframe>
									
								<p>El ejemplo es impresionante. Todo en este ejemplo es para destacar. El movimiento del agua, el efecto de gravedad, las texturas, los reflejos y manejo de luces, el manejo de la pausa y las interacciones en este estado.</p>
								<p>El ejemplo en código por otro lado es bastante complejo y se me escapan muchas (la verdad la mayoría) de cosas que el autor realiza. Gran mayoría de las cosas que se realizan sobrepasan mi conocimiento. No obstante daré un pequeño resumen de lo que realiza.</p>
							

							
								<header>
                                    <h3 class="tm-blue-text tm-margin-b-45">Breve, pero brevísimo resumen</h3>
                                </header>
								<p> 
									Gran parte de toda la lógica detrás del ejemplo se maneja es con diferentes shaders. Pero ya lo verémos en detalle. Miremos la estructura de archivos que maneja.
								</p>
									<ul>
										<li>cubemap.js</li>
										<li>lightgl.js</li>
										<li>main.js</li>
										<li>OES_texture_float_linear-polyfill.js</li>
										<li>render.js</li>
										<li>water.js</li>
									</ul>
								<p> Repasemos uno a uno</p>
								<header>
                                    <h4 class="tm-blue-text tm-margin-b-45">Cubemap</h4>
                                </header>
								<p>El script más simple. Solo se ncarga de la texturas del cubo donde se está dibujando todo.</p>
								
								<header>
                                    <h4 class="tm-blue-text tm-margin-b-45">lightgl</h4>
                                </header>
								<p>Este script hace todo lo relacionado a la logística matemática. En primera define el contexto. Define operaciones matriciales para el manejo de la cámara. También define operaciones de pila para matrices. Maneja la lógica de los colores. También se encarga de los eventos del usuario. No menos imporante maneja la carga de mallas, texturas y definición de vectores.</p>
								
								<p>Sin embargo, su tarea principal es manejar los procedimientos matem[aticos y recurrentes. Más logística que técnica. Inversiones, multiplicaciones matriciales, etc</p>
								
								<header>
                                    <h4 class="tm-blue-text tm-margin-b-45">renderer</h4>
                                </header>
								<p>Uno de los más importantes. Acá se definen los elementos que realmente van a desplegar la visualización. Acá se define la manera en que se va a pintar eso. Para eso primero se define una variable <strong>helper</strong>. En el se definene las cosas básicas de dibujo que bajo cualquier situación o interacción se debe pintar. El agua, los muros, la esfera.</p>
								<p>Se define también un renderer que es el encargado de pintar el agua. Acá se definene elementos como la dirección de la luz, la textura, la malla del agua. Para dibujar el agua se crean dos shaders.</p>
								
								<pre align = "left">for (var i = 0; i < 2; i++) {
this.waterShaders[i] = new GL.Shader('\</pre>
								
								<p> más abajo cerca de las líneas 165 en adelante se define que cada shader será por si se mira debajo del agua o pode encima del agua. Los cambios se definen en el vector normal, en la manera de reflexión de la luz y la manera de visualizar. </p>
								
								<p><strong>Debajo del agua</p></strong>
								<pre align = "left">normal = -normal;\
vec3 reflectedRay = reflect(incomingRay, normal);\
vec3 refractedRay = refract(incomingRay, normal, IOR_WATER / IOR_AIR);\
float fresnel = mix(0.5, 1.0, pow(1.0 - dot(normal, -incomingRay), 3.0));\
\
vec3 reflectedColor = getSurfaceRayColor(position, reflectedRay, underwaterColor);\
vec3 refractedColor = getSurfaceRayColor(position, refractedRay, vec3(1.0)) * vec3(0.8, 1.0, 1.1);\
\
gl_FragColor = vec4(mix(reflectedColor, refractedColor, (1.0 - fresnel) * length(refractedRay)), 1.0);\</pre>

								<p><strong>Sobre el agua</p></strong>
								<pre align = "left">vec3 reflectedRay = reflect(incomingRay, normal);\
vec3 refractedRay = refract(incomingRay, normal, IOR_AIR / IOR_WATER);\
float fresnel = mix(0.25, 1.0, pow(1.0 - dot(normal, -incomingRay), 3.0));\
\
vec3 reflectedColor = getSurfaceRayColor(position, reflectedRay, abovewaterColor);\
vec3 refractedColor = getSurfaceRayColor(position, refractedRay, abovewaterColor);\
\
gl_FragColor = vec4(mix(refractedColor, reflectedColor, fresnel), 1.0);\</pre>
																
								<p> Después de esto también se define un shader para la esfera.</p>
								
								<pre align = "left">this.sphereShader = new GL.Shader(helperFunctions + '\
varying vec3 position;\
void main() {\
position = sphereCenter + gl_Vertex.xyz * sphereRadius;\
gl_Position = gl_ModelViewProjectionMatrix * vec4(position, 1.0);\
}\
', helperFunctions + '\
varying vec3 position;\
void main() {\
gl_FragColor = vec4(getSphereColor(position), 1.0);\
vec4 info = texture2D(water, position.xz * 0.5 + 0.5);\
if (position.y < info.r) {\
gl_FragColor.rgb *= underwaterColor * 1.2;\
}\
}\
');</pre>
								<p> También se define para el cubo y para el agua ademas de algunas funciones de actualziación. Como nos podemos dar cuenta. El grueso del trabajo está sobre los shaders</p>
								
								
								<header>
                                    <h4 class="tm-blue-text tm-margin-b-45">water</h4>
                                </header>
								
								<p> Esta clase es la que no entiendo bien. Si bien es claro que su función es crear shaders (si, también shaders)  no encuentro la relación con la clase anterior. Creo que su finción está más centrada a las interacciones pues maneja mpetodos como mover la esfera, pasos de simulación (Cuando se mueve la pelota el agua hace un movimiento que empieza a parar con el paso del tiempo). Actualiza los vectores normales para dibujar entre otros.<p/>
								
								<p> El entendimiento está en proceso y empezaré a actualizar a medida que vaya entendiendo.<p>
								
								
								<header>
                                    <h4 class="tm-blue-text tm-margin-b-45">OES_texture_float_linear-polyfill.js</h4>
                             </header>
							
							<p> Esta es una extensión para el manejo de texturas. Es una mejora a una librería anterior creada por el mismo autor. La información la encontramos <a href = "https://github.com/evanw/OES_texture_float_linear-polyfill">aquí</a>
							
							<header>
                                    <h4 class="tm-blue-text tm-margin-b-45">main</h4>
                             </header>
							<p> Llegamos a la clase que lo hace todo y nada a la vez. Como es de suponer, el script main es el gran orquestador. Realiza las tareas de organización. Dice que ejecutarse y cuando. Hace tareas de organización. Acá exponemos solo dos de los métodos más importantes.</p>
							
							<pre align = "left">
function update(seconds) {
if (seconds > 1) return;
frame += seconds * 2;

if (mode == MODE_MOVE_SPHERE) {
  // Start from rest when the player releases the mouse after moving the sphere
  velocity = new GL.Vector();
} else if (useSpherePhysics) {
  // Fall down with viscosity under water
  var percentUnderWater = Math.max(0, Math.min(1, (radius - center.y) / (2 * radius)));
  velocity = velocity.add(gravity.multiply(seconds - 1.1 * seconds * percentUnderWater));
  velocity = velocity.subtract(velocity.unit().multiply(percentUnderWater * seconds * velocity.dot(velocity)));
  center = center.add(velocity.multiply(seconds));

  // Bounce off the bottom
  if (center.y < radius - 1) {
	center.y = radius - 1;
	velocity.y = Math.abs(velocity.y) * 0.7;
  }
}

// Displace water around the sphere
water.moveSphere(oldCenter, center, radius);
oldCenter = center;

// Update the water simulation and graphics
water.stepSimulation();
water.stepSimulation();
water.updateNormals();
renderer.updateCaustics(water);
}

function draw() {
// Change the light direction to the camera look vector when the L key is pressed
if (GL.keys.L) {
  renderer.lightDir = GL.Vector.fromAngles((90 - angleY) * Math.PI / 180, -angleX * Math.PI / 180);
  if (paused) renderer.updateCaustics(water);
}

gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
gl.loadIdentity();
gl.translate(0, 0, -4);
gl.rotate(-angleX, 1, 0, 0);
gl.rotate(-angleY, 0, 1, 0);
gl.translate(0, 0.5, 0);

gl.enable(gl.DEPTH_TEST);
renderer.sphereCenter = center;
renderer.sphereRadius = radius;
renderer.renderCube();
renderer.renderWater(water, cubemap);
renderer.renderSphere();
gl.disable(gl.DEPTH_TEST);
}
							</pre>
							
							<p> Vemos que solo realiza el llamado a las funciones. Otro manejo importante se hace sobre los que definene las acciones de cuando se realiza un drag sobre el escenario y cuando este termina.</p>
								
								
                            </section>
                           
						   <section id="Extra" class="tm-section">
                                <header>
                                    <h2 class="tm-blue-text tm-welcome-title tm-margin-b-45">Extra</h2>
                                </header>
							
								<p> A manera de información, me gustaría compartirles una librería que en algún momento utilicé. La considero perfecta para hacer trabajo de manera rápida sin mucho conocimiento y con resultados ágiles. Si bien parece estar orientada a propósitos médicos, tienen herramientas que son <strong>muy faciles</strong> de usar. <a href = "https://github.com/xtk/X"> XTK </a> es una librería con primitivas muy sencillas que realizan mucho de los que se necesita. Acá les dejo 4 de los ejemplos donde pueden ver lo fácil que es hacer desarrollo</p>
								
								
								<script async src="//jsfiddle.net/lakfel/5m2mc7t8/embed/"></script>
						
								<script async src="//jsfiddle.net/lakfel/Lmjvy0wy/embed/"></script>
					
								<script async src="//jsfiddle.net/lakfel/cghacv2t/embed/"></script>
						
								<script async src="//jsfiddle.net/lakfel/0ghuwrk9/embed/"></script>
							

								
							</section>
                        </div>  
                        
                    </div> <!-- Right column: content -->
                </div>
            </div> <!-- row -->
        </div> <!-- container -->
                
        <!-- load JS files -->
        <script src="js/jquery-1.11.3.min.js"></script>             <!-- jQuery (https://jquery.com/download/) -->
        <script src="js/jquery.magnific-popup.min.js"></script>     <!-- Magnific pop-up (http://dimsemenov.com/plugins/magnific-popup/) -->
        <script src="js/jquery.singlePageNav.min.js"></script>      <!-- Single Page Nav (https://github.com/ChrisWojcik/single-page-nav) -->
        
		<script>     
       
            $(document).ready(function(){

                // Single page nav
                $('.tm-main-nav').singlePageNav({
                    'currentClass' : "active",
                    offset : 20
                });

                // Magnific pop up
                $('.tm-gallery-1').magnificPopup({
                  delegate: 'a', // child items selector, by clicking on it popup will open
                  type: 'image',
                  gallery: {enabled:true}
                  // other options
                }); 

                $('.tm-gallery-2').magnificPopup({
                  delegate: 'a', // child items selector, by clicking on it popup will open
                  type: 'image',
                  gallery: {enabled:true}
                  // other options
                }); 

                $('.tm-gallery-3').magnificPopup({
                  delegate: 'a', // child items selector, by clicking on it popup will open
                  type: 'image',
                  gallery: {enabled:true}
                  // other options
                }); 

                $('.tm-current-year').text(new Date().getFullYear());                
            });
        </script>             
</body>
</html>